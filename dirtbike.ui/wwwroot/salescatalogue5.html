<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sales Catalogue Maintenance</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="login.css" />
  <link rel="stylesheet" href="dropmenu.css" />
<script src="./js/bikes.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style>
 .jsmenu {
  padding: 0;
  margin: 0;
  border: none;
  background: none;
  width: 50px;
  height: 50px;
  display: inline-block;
}

.jsmenu img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover; /* Optional: ensures image fills the button */
  border: none;
}

.jsfooterextension
{
  display: flex;
  justify-content: center;   /* Horizontal alignment */
  align-items: center;       /* Vertical alignment */
  background-color: grey;
  max-height: 250px;
  height: 250px;
  font-size: 8pt;
}

</style>
</head>


<body onload="checkUserStatus(); displayProfilePicture(); writelocation();">
 <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="index.html">Site Home</a>
                  <a href="cart5.html">MyCart</a>
                  <a href="mybookings5.html">MyReservations</a>
                  <a href="manager.html">Manager Utilities</a>
            </div>
    </div> 
         <div class="logo" align="left">&nbsp&nbspMyLinkV25 - Sales Catalogue</div>  
      </div>
      <div class="nav-right">
          <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='../profile.html'" width="30px" height="30px"/> 
          <span id="H3UserBanner">User</span>
          <button id="logoutBtn" onclick="onLogout(event)">Logout</button>
        </div>
      </div>
  <div class="container py-5">

    <div class="mb-4 text-center">
      <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addModal">Add Item</button>
      <button class="btn btn-warning" id="updateBtn" disabled data-bs-toggle="modal" data-bs-target="#updateModal">Update Selected Item</button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>Service Type</th>
            <th>Service Name</th>
            <th>Description</th>
            <th>Price ($)</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Is Active</th>
            <th>Park ID</th>
          </tr>
        </thead>
        <tbody id="sales-table-body"></tbody>
      </table>
    </div>
  </div>

  <!-- Add Modal -->
  <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="addForm">
          <div class="modal-header">
            <h5 class="modal-title" id="addModalLabel">Add Sales Item</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body row g-3">
            <div class="col-md-6"><label class="form-label">Service Type</label><input type="text" class="form-control" name="serviceType" required></div>
            <div class="col-md-6"><label class="form-label">Service Name</label><input type="text" class="form-control" name="serviceName" required></div>
            <div class="col-md-12"><label class="form-label">Description</label><textarea class="form-control" name="description"></textarea></div>
            <div class="col-md-6"><label class="form-label">Price</label><input type="number" step="0.01" class="form-control" name="price"></div>
            <div class="col-md-6"><label class="form-label">Park ID</label><input type="number" class="form-control" name="parkId"></div>
            <div class="col-md-6"><label class="form-label">Start Date</label><input type="date" class="form-control" name="startDate"></div>
            <div class="col-md-6"><label class="form-label">End Date</label><input type="date" class="form-control" name="endDate"></div>
            <div class="col-md-6"><label class="form-label">Is Active</label><select class="form-select" name="isActive"><option value="1">Yes</option><option value="0">No</option></select></div>
          </div>
          <div class="modal-footer"><button type="submit" class="btn btn-success">Submit</button></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Update Modal -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="updateForm">
          <div class="modal-header">
            <h5 class="modal-title" id="updateModalLabel">Update Sales Item</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body row g-3">
            <input type="hidden" name="salesCatalogueId" id="updateId">
            <div class="col-md-6"><label class="form-label">Service Type</label><input type="text" class="form-control" name="serviceType" id="updateType"></div>
            <div class="col-md-6"><label class="form-label">Service Name</label><input type="text" class="form-control" name="serviceName" id="updateName"></div>
            <div class="col-md-12"><label class="form-label">Description</label><textarea class="form-control" name="description" id="updateDesc"></textarea></div>
            <div class="col-md-6"><label class="form-label">Price</label><input type="number" step="0.01" class="form-control" name="price" id="updatePrice"></div>
            <div class="col-md-6"><label class="form-label">Park ID</label><input type="number" class="form-control" name="parkId" id="updateParkId"></div>
            <div class="col-md-6"><label class="form-label">Start Date</label><input type="date" class="form-control" name="startDate" id="updateStart"></div>
            <div class="col-md-6"><label class="form-label">End Date</label><input type="date" class="form-control" name="endDate" id="updateEnd"></div>
            <div class="col-md-6"><label class="form-label">Is Active</label><select class="form-select" name="isActive" id="updateActive"><option value="1">Yes</option><option value="0">No</option></select></div>
          </div>
          <div class="modal-footer"><button type="submit" class="btn btn-warning">Update</button></div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let allItems = [];
    let selectedId = null;

    $(document).ready(function () {
      $.getJSON("https://gridactions3b.547bikes.info/api/SalesCatalogue", function (data) {
        allItems = data;
        renderTable(data);
      });

      function renderTable(items) {
        const tbody = $("#sales-table-body").empty();
        items.forEach(item => {
          const row = `
            <tr>
              <td><input type="radio" name="selectedItem" value="${item.salesCatalogueId}"></td>
              <td>${item.serviceType}</td>
              <td>${item.serviceName}</td>
              <td>${item.description}</td>
              <td>${item.price.toFixed(2)}</td>
              <td>${item.startDate}</td>
              <td>${item.endDate}</td>
              <td>${item.isActive ? "Yes" : "No"}</td>
              <td>${item.parkId}</td>
            </tr>
          `;
          tbody.append(row);
        });
      }

      $(document).on("change", "input[name='selectedItem']", function () {
        selectedId = $(this).val();
        $("#updateBtn").prop("disabled", !selectedId);
      });

      $("#updateBtn").on("click", function () {
        const item = allItems.find(i => i.salesCatalogueId == selectedId);
        if (item) {
          $("#updateId").val(item.salesCatalogueId);
          $("#updateType").val(item.serviceType);
          $("#updateName").val(item.serviceName);
          $("#updateDesc").val(item.description);
          $("#updatePrice").val(item.price);
          $("#updateParkId").val(item.parkId);
          $("#updateStart").val(item.startDate);
          $("#updateEnd").val(item.endDate);
          $("#updateActive").val(item.isActive);
        }
      });

      $("#addForm").on("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        $.ajax({
          url: "https://gridactions3b.547bikes.info/api/SalesCatalogue",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify(data),
          success: () => location.reload(),
          error: () => alert("Error adding item")
        });
      });

      $("#updateForm").on("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        $.ajax({
          url: `https://gridactions3b.547bikes.info/api/SalesCatalogue/${data.salesCatalogueId}`,
          method: "PUT",
          contentType: "application/json",
        data: JSON.stringify(data),
        success: () => location.reload(),
        error: () => alert("Error updating item")
      });
    });
  });
</script>
</body>
</html>