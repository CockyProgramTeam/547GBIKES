<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sales Catalogue Maintenance</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="login.css" />
  <link rel="stylesheet" href="dropmenu.css" />
<script src="./js/bikes.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style>
 .jsmenu {
  padding: 0;
  margin: 0;
  border: none;
  background: none;
  width: 50px;
  height: 50px;
  display: inline-block;
}

.jsmenu img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover; /* Optional: ensures image fills the button */
  border: none;
}

.jsfooterextension
{
  display: flex;
  justify-content: center;   /* Horizontal alignment */
  align-items: center;       /* Vertical alignment */
  background-color: grey;
  max-height: 250px;
  height: 250px;
  font-size: 8pt;
}
#userGreeting
{
text-align: center;
vertical-align: middle;
color: white;
}
#banner
{
background-color: lightgrey;
height: 60px;
vertical-align: middle;
width: 100%;
}

#cancelBtn
{
width: 400px;
}

#splash
{
font-size: 12pt;
}
</style>
</head>


<body onload="checkpll(); checkUserStatus(); displayProfilePicture();">
    <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="index.html">Site Home</a>
                  <a href="cart5.html?uid=1">MyCart</a>
                  <a href="parks5.html">Review Park Options</a>
                  <a href="parksreview5.html">Park Reviews</a>
                  <a href="mybookings5.html">MyReservations</a>
                  <a href="manager.html">Manager Utilities</a>
             </div>
    </div> 
      <div class="logo">&nbsp&nbsp<H5>MyLinkv25 - Review Parks</H5></div>
      </div>
      <div class="nav-right">
        <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='profile.html'" />
        <span id="H3UserBanner"></span>
        <a href="login.html" id="loginBtn" class="btn secondary-btn" onclick="loginUser(event)">Login</a>
        <a href="login.html" id="logoutBtn" class="btn secondary-btn" onclick="logoutUser(event)">Logout</a>
        <a href="cart5.html?uid=1" id="cartBtn" class="btn secondary-btn" onclick="checkUser(event)">Cart</a>
      </div>
    </div>
<div align="center" id="banner"><span id="userGreeting">Welcome Guest</span></div>
  <div class="container py-5">

    <div class="mb-4 text-center">
      <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addModal">Add Item</button>
      <button class="btn btn-warning" id="updateBtn" disabled data-bs-toggle="modal" data-bs-target="#updateModal">Update Selected Item</button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>Service Type</th>
            <th>Service Name</th>
            <th>Description</th>
            <th>Price ($)</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Is Active</th>
            <th>Park ID</th>
          </tr>
        </thead>
        <tbody id="sales-table-body"></tbody>
      </table>
    </div>
  </div>

  <!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="addForm">
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">Add Sales Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-6">
            <label class="form-label">Service Type</label>
            <input type="text" class="form-control" name="serviceType" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Service Name</label>
            <input type="text" class="form-control" name="serviceName" required>
          </div>
          <div class="col-md-12">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description"></textarea>
          </div>
          <div class="col-md-6">
            <label class="form-label">Price</label>
            <input type="number" step="0.01" class="form-control" name="price">
          </div>
          <div class="col-md-6">
            <label class="form-label">Park ID</label>
            <input type="number" class="form-control" name="parkId">
          </div>
          <div class="col-md-6">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-control" name="startDate">
          </div>
          <div class="col-md-6">
            <label class="form-label">End Date</label>
            <input type="date" class="form-control" name="endDate">
          </div>
          <div class="col-md-6">
            <label class="form-label">Is Active</label>
            <select class="form-select" name="isActive">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Site ID</label>
            <input type="number" class="form-control" name="siteId">
          </div>
          <div class="col-md-6">
            <label class="form-label">National</label>
            <input type="text" class="form-control" name="national">
          </div>
          <div class="col-md-6">
            <label class="form-label">State</label>
            <input type="text" class="form-control" name="state">
          </div>
          <div class="col-md-6">
            <label class="form-label">Global</label>
            <input type="text" class="form-control" name="global">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="updateForm">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">Update Sales Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal">Cancel</button>
        </div>
        <div class="modal-body row g-3">
          <input type="hidden" name="salesCatalogueId" id="updateId">

          <div class="col-md-6">
            <label class="form-label">Service Type</label>
            <input type="text" class="form-control" name="serviceType" id="updateType">
          </div>

          <div class="col-md-6">
            <label class="form-label">Service Name</label>
            <input type="text" class="form-control" name="serviceName" id="updateName">
          </div>

          <div class="col-md-12">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" id="updateDesc"></textarea>
          </div>

          <div class="col-md-6">
            <label class="form-label">Price</label>
            <input type="number" step="0.01" class="form-control" name="price" id="updatePrice">
          </div>

          <div class="col-md-6">
            <label class="form-label">Park ID</label>
            <input type="number" class="form-control" name="parkId" id="updateParkId">
          </div>

          <div class="col-md-6">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-control" name="startDate" id="updateStart">
          </div>

          <div class="col-md-6">
            <label class="form-label">End Date</label>
            <input type="date" class="form-control" name="endDate" id="updateEnd">
          </div>

          <div class="col-md-6">
            <label class="form-label">Is Active</label>
            <select class="form-select" name="isActive" id="updateActive">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Site ID</label>
            <input type="number" class="form-control" name="siteId" id="updateSiteId">
          </div>

          <div class="col-md-6">
            <label class="form-label">National</label>
            <input type="text" class="form-control" name="national" id="updateNational">
          </div>

          <div class="col-md-6">
            <label class="form-label">State</label>
            <input type="text" class="form-control" name="state" id="updateState">
          </div>

          <div class="col-md-6">
            <label class="form-label">Global</label>
            <input type="text" class="form-control" name="global" id="updateGlobal">
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-warning">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let allItems = [];
  let selectedId = null;

  $(document).ready(function () {
    // Load data
    $.getJSON("https://gridactions3b.547bikes.info/api/SalesCatalogue", function (data) {
      allItems = data;
      renderTable(data);
    });

    // Render table
    function renderTable(items) {
      const tbody = $("#sales-table-body").empty();
      items.forEach(item => {
        const row = `
          <tr>
            <td><input type="radio" name="selectedItem" value="${item.salesCatalogueId}"></td>
            <td>${item.serviceType}</td>
            <td>${item.serviceName}</td>
            <td>${item.description}</td>
            <td>${item.price.toFixed(2)}</td>
            <td>${item.startDate}</td>
            <td>${item.endDate}</td>
            <td>${item.isActive ? "Yes" : "No"}</td>
            <td>${item.parkId}</td>
          </tr>
        `;
        tbody.append(row);
      });
    }

    // Select item
    $(document).on("change", "input[name='selectedItem']", function () {
      selectedId = $(this).val();
      $("#updateBtn").prop("disabled", !selectedId);
    });

    // Populate update modal
    $("#updateBtn").on("click", function () {
      const item = allItems.find(i => i.salesCatalogueId == selectedId);
      if (item) {
        $("#updateId").val(item.salesCatalogueId);
        $("#updateType").val(item.serviceType);
        $("#updateName").val(item.serviceName);
        $("#updateDesc").val(item.description);
        $("#updatePrice").val(item.price);
        $("#updateParkId").val(item.parkId);
        $("#updateStart").val(item.startDate);
        $("#updateEnd").val(item.endDate);
        $("#updateActive").val(item.isActive);
        $("#updateSiteId").val(item.siteId ?? '');
        $("#updateNational").val(item.national ?? 0);
        $("#updateState").val(item.state ?? 0);
        $("#updateGlobal").val(item.global ?? 0);
        $("#updateQtyAdults").val(item.qtyadults ?? 0);
        $("#updateQtyChildren").val(item.qtychildren ?? 0);
        $("#updateModal").modal("show");
      }
    });

    // Add form submit
    $("#addForm").on("submit", function (e) {
      e.preventDefault();

      const data = {
        salesCatalogueId: 0,
        parkId: parseInt($("input[name='parkId']").val()),
        serviceType: $("input[name='serviceType']").val()?.trim() || "DefaultType",
        serviceName: $("input[name='serviceName']").val()?.trim() || "Unnamed",
        description: $("textarea[name='description']").val()?.trim() || "No description",
        price: parseFloat($("input[name='price']").val()),
        isActive: parseInt($("select[name='isActive']").val()) || 1,
        siteId: $("input[name='siteId']").val()?.trim() || "",
        state: parseInt($("input[name='state']").val()) || 0,
        global: parseInt($("input[name='global']").val()) || 0,
        qtyadults: parseInt($("input[name='qtyadults']").val()) || 0,
        qtychildren: parseInt($("input[name='qtychildren']").val()) || 0,
        national: parseInt($("input[name='national']").val()) || 0,
        startDate: $("input[name='startDate']").val() || new Date().toISOString(),
        endDate: $("input[name='endDate']").val() || new Date().toISOString()
      };

      if (!data.parkId || isNaN(data.parkId)) {
        alert("Park ID is required and must be a number.");
        return;
      }
      if (!data.price || isNaN(data.price)) {
        alert("Price is required and must be a number.");
        return;
      }

      console.log("Submitting:", data);

      $.ajax({
        url: "https://gridactions3b.547bikes.info/api/SalesCatalogue",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: () => location.reload(),
        error: (xhr) => {
          console.error("Error:", xhr.responseText);
          alert("Error adding item. Check console for details.");
        }
      });
    });

    // Update form submit
    $("#updateForm").on("submit", function (e) {
      e.preventDefault();

      const data = {
        salesCatalogueId: parseInt($("#updateId").val()),
        parkId: parseInt($("#updateParkId").val()),
        serviceType: $("#updateType").val()?.trim() || "DefaultType",
        serviceName: $("#updateName").val()?.trim() || "Unnamed",
        description: $("#updateDesc").val()?.trim() || "No description",
        price: parseFloat($("#updatePrice").val()),
        isActive: parseInt($("#updateActive").val()) || 1,
        siteId: $("#updateSiteId").val()?.trim() || "",
        state: parseInt($("#updateState").val()) || 0,
        global: parseInt($("#updateGlobal").val()) || 0,
        qtyadults: parseInt($("#updateQtyAdults").val()) || 0,
        qtychildren: parseInt($("#updateQtyChildren").val()) || 0,
        national: parseInt($("#updateNational").val()) || 0,
        startDate: $("#updateStart").val() || new Date().toISOString(),
        endDate: $("#updateEnd").val() || new Date().toISOString()
      };

      if (!data.parkId || isNaN(data.parkId)) {
        alert("Park ID is required and must be a number.");
        return;
      }
      if (!data.price || isNaN(data.price)) {
        alert("Price is required and must be a number.");
        return;
      }

      console.log("Updating:", data);

      $.ajax({
        url: `https://gridactions3b.547bikes.info/api/SalesCatalogue/${data.salesCatalogueId}`,
        method: "PUT",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: () => location.reload(),
        error: (xhr) => {
          console.error("Error:", xhr.responseText);
          alert("Error updating item. Check console for details.");
        }
      });
    });
  });
</script>


</body>
</html>
