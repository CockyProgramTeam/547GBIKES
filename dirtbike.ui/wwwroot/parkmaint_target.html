<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="home.css" />
<link rel="stylesheet" href="dropmenu.css" />
<link rel="stylesheet" href="adminhome.css" />
  <title>Park Maintenance</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body onload="checkUserStatus()">
  <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="..\employeehome.html">Employee Home</a>
                  <a href="adminhome.html">EmployeeAdmin</a>
                  <a href="adminservices.html">ServicesAdmin</a>
                  <a href="whitelabeladmin.html">WhiteLabelAdmin</a>
                  <a href="adminstuff.html">Admin Tools</a>
                  <a href="..\certs\adminmycerts.html">Admin MyCerts</a>
                  <a href="..\corp\corporatevents.html">Corporate Events</a>
            </div>
    </div> 
         <div class="logo" align="left">&nbsp&nbspMyLinkV25 - Parks Maintenance</div>  
      </div>
      <div class="nav-right">
          <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='../profile.html'" width="30px" height="30px"/> 
          <span id="H3UserBanner">User</span>
          <button id="logoutBtn" onclick="onLogout(event)">Logout</button>
        </div>
      </div>

  <div class="container py-5">
   <div align="center"><img src="./images/centralpark.png" width="100%" height="350px"></div><BR>
    <div class="mb-4 text-center">
      <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addParkModal">Add Park</button>
      <button class="btn btn-warning" id="updateParkBtn" disabled data-bs-toggle="modal" data-bs-target="#updateParkModal">Update Selected Park</button>
      <button class="btn btn-warning" id="updateParkBtn" disabled data-bs-toggle="modal" data-bs-target="#bulkUpload">Bulk Upload Parks</button>
	  <button id="deleteParkBtn" class="btn btn-danger" disabled>Delete Selected Park</button>
    </div>
  
  <div class="mb-4">
  <label for="stateFilter" class="form-label">Filter by State:</label>
  <select id="stateFilter" class="form-select" onchange="filterParksByState()">
    <option value="all">All States</option>
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>
  </select>
</div>


    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>Park Name</th>
            <th>State</th>
            <th>Region</th>
            <th>Address</th>
            <th>Phone</th>
            <th>Trail Length (mi)</th>
            <th>Difficulty</th>
            <th>Day Pass ($)</th>
            <th>Max Visitors</th>
            <th>Current Visitors</th>
            <th>Adults</th>
            <th>Children</th>
            <th>Max Campsites</th>
            <th>Trail Map</th>
            <th>Logo</th>
          </tr>
        </thead>
        <tbody id="park-table-body"></tbody>
      </table>
    </div>
  </div>

 <!-- Add Park Modal -->
<div class="modal fade" id="addParkModal" tabindex="-1" aria-labelledby="addParkModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <form id="addParkForm">
        <div class="modal-header">
          <h5 class="modal-title" id="addParkModalLabel">Add New Park</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-6">
            <label for="addName" class="form-label">Park Name</label>
            <input type="text" class="form-control" id="addName" name="name" required>
          </div>
          <div class="col-md-6">
            <label for="addRegion" class="form-label">Region</label>
            <input type="text" class="form-control" id="addRegion" name="region">
          </div>
          <div class="col-md-6">
            <label for="addState" class="form-label">State</label>
            <input type="text" class="form-control" id="addState" name="state">
          </div>
          <div class="col-md-6">
            <label for="addAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="addAddress" name="address">
          </div>
          <div class="col-md-6">
            <label for="addPhone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="addPhone" name="phone">
          </div>
          <div class="col-md-6">
            <label for="addTrailLength" class="form-label">Trail Length (mi)</label>
            <input type="number" step="0.1" class="form-control" id="addTrailLength" name="trailLengthMiles">
          </div>
          <div class="col-md-6">
            <label for="addDifficulty" class="form-label">Difficulty</label>
            <input type="text" class="form-control" id="addDifficulty" name="difficulty">
          </div>
          <div class="col-md-6">
            <label for="addDayPass" class="form-label">Day Pass ($)</label>
            <input type="number" step="0.01" class="form-control" id="addDayPass" name="dayPassPriceUsd">
          </div>
          <div class="col-md-6">
            <label for="addMaxVisitors" class="form-label">Max Visitors</label>
            <input type="number" class="form-control" id="addMaxVisitors" name="maxvisitors">
          </div>
          <div class="col-md-6">
            <label for="addCurrentVisitors" class="form-label">Current Visitors</label>
            <input type="number" class="form-control" id="addCurrentVisitors" name="currentvisitors">
          </div>
          <div class="col-md-6">
            <label for="addAdults" class="form-label">Adults</label>
            <input type="number" class="form-control" id="addAdults" name="currentvisitorsadults">
          </div>
          <div class="col-md-6">
            <label for="addChildren" class="form-label">Children</label>
            <input type="number" class="form-control" id="addChildren" name="currentvisitorschildren">
          </div>
          <div class="col-md-6">
            <label for="addMaxCampsites" class="form-label">Max Campsites</label>
            <input type="number" class="form-control" id="addMaxCampsites" name="maxcampsites">
          </div>
          <div class="col-md-6">
            <label for="addTrailMapUrl" class="form-label">Trail Map URL</label>
            <input type="url" class="form-control" id="addTrailMapUrl" name="trailmapurl">
          </div>
          <div class="col-md-6">
            <label for="addLogoUrl" class="form-label">Logo URL</label>
            <input type="url" class="form-control" id="addLogoUrl" name="parklogourl">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

 <!-- Update Park Modal -->
<div class="modal fade" id="updateParkModal" tabindex="-1" aria-labelledby="updateParkModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="updateParkForm">
        <div class="modal-header">
          <h5 class="modal-title" id="updateParkModalLabel">Update Park</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body row g-3">
          <input type="hidden" id="updateParkId" name="parkId">

          <div class="col-md-6">
            <label for="updateName" class="form-label">Park Name</label>
            <input type="text" class="form-control" id="updateName" name="name" required>
          </div>

          <div class="col-md-6">
            <label for="updateAddress" class="form-label">Address</label>
            <input type="text" class="form-control" id="updateAddress" name="address">
          </div>

          <div class="col-md-6">
            <label for="updatePhone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="updatePhone" name="phone">
          </div>

          <div class="col-md-6">
            <label for="updateRegion" class="form-label">Region</label>
            <input type="text" class="form-control" id="updateRegion" name="region">
          </div>

          <div class="col-md-6">
            <label for="updateTrailLength" class="form-label">Trail Length (miles)</label>
            <input type="number" step="0.01" class="form-control" id="updateTrailLength" name="trailLengthMiles">
          </div>

          <div class="col-md-6">
            <label for="updateDifficulty" class="form-label">Difficulty</label>
            <input type="text" class="form-control" id="updateDifficulty" name="difficulty">
          </div>

          <div class="col-md-12">
            <label for="updateDescription" class="form-label">Description</label>
            <textarea class="form-control" id="updateDescription" name="description" rows="3"></textarea>
          </div>

          <div class="col-md-6">
            <label for="updateDayPassPrice" class="form-label">Day Pass Price (USD)</label>
            <input type="number" step="0.01" class="form-control" id="updateDayPassPrice" name="dayPassPriceUsd">
          </div>

          <div class="col-md-6">
            <label for="updateLatitude" class="form-label">Latitude</label>
            <input type="number" step="0.000001" class="form-control" id="updateLatitude" name="latitude">
          </div>

          <div class="col-md-6">
            <label for="updateLongitude" class="form-label">Longitude</label>
            <input type="number" step="0.000001" class="form-control" id="updateLongitude" name="longitude">
          </div>

          <div class="col-md-6">
            <label for="updateTrailMapUrl" class="form-label">Trail Map URL</label>
            <input type="url" class="form-control" id="updateTrailMapUrl" name="trailmapurl">
          </div>

          <div class="col-md-6">
            <label for="updateParkLogoUrl" class="form-label">Park Logo URL</label>
            <input type="url" class="form-control" id="updateParkLogoUrl" name="parklogourl">
          </div>

          <div class="col-md-6">
            <label for="updateMaxVisitors" class="form-label">Max Visitors</label>
            <input type="number" class="form-control" id="updateMaxVisitors" name="maxvisitors">
          </div>

          <div class="col-md-6">
            <label for="updateCurrentVisitors" class="form-label">Current Visitors</label>
            <input type="number" class="form-control" id="updateCurrentVisitors" name="currentvisitors">
          </div>

          <div class="col-md-6">
            <label for="updateCurrentChildren" class="form-label">Current Children Visitors</label>
            <input type="number" class="form-control" id="updateCurrentChildren" name="currentvisitorschildren">
          </div>

          <div class="col-md-6">
            <label for="updateCurrentAdults" class="form-label">Current Adult Visitors</label>
            <input type="number" class="form-control" id="updateCurrentAdults" name="currentvisitorsadults">
          </div>

          <div class="col-md-6">
            <label for="updateMaxCampsites" class="form-label">Max Campsites</label>
            <input type="number" class="form-control" id="updateMaxCampsites" name="maxcampsites">
          </div>

          <div class="col-md-6">
            <label for="updateState" class="form-label">State</label>
            <input type="text" class="form-control" id="updateState" name="state">
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-warning">Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let allParks = [];
  let selectedPark = null;

$(document).ready(function () {
  $.ajax({
    url: "https://gridactions3b.547bikes.info/api/Parks",
    method: "GET",
    success: function (parks) {
      allParks = parks;
      renderParkTable(parks);
    },
    error: function (xhr, status, error) {
      $("#park-table-body").html(
        `<tr><td colspan="16" class="text-danger">Error loading park data: ${error}</td></tr>`
      );
    }
  });
});

    // Render table with optional filtering
    function renderParkTable(parks) {
      const tableBody = $("#park-table-body");
      tableBody.empty();
      parks.forEach(function (park) {
        const trailMap = park.trailmapurl ? `<a href="${park.trailmapurl}" target="_blank">Map</a>` : `<span class="text-muted">N/A</span>`;
        const logo = park.parklogourl ? `<img src="${park.parklogourl}" alt="Logo" style="max-height:40px;">` : `<span class="text-muted">N/A</span>`;
        const row = `
          <tr>
            <td><input type="radio" name="selectedPark" value="${park.parkId}"></td>
            <td>${park.name}</td>
            <td>${park.state}</td>
            <td>${park.region}</td>
            <td>${park.address}</td>
            <td>${park.phone}</td>
            <td>${park.trailLengthMiles}</td>
            <td>${park.difficulty}</td>
            <td>${typeof park.dayPassPriceUsd === "number" ? park.dayPassPriceUsd.toFixed(2) : "N/A"}</td>
            <td>${park.maxvisitors}</td>
            <td>${park.currentvisitors}</td>
            <td>${park.currentvisitorsadults}</td>
            <td>${park.currentvisitorschildren}</td>
            <td>${park.maxcampsites}</td>
            <td>${trailMap}</td>
            <td>${logo}</td>
          </tr>
        `;
        tableBody.append(row);
      });
    }
    
    // Filter parks by selected state
    window.filterParksByState = function () {
      const selectedState = $("#stateFilter").val();
      const filtered = selectedState === "all"
        ? allParks
        : allParks.filter(p => p.state === selectedState);
      renderParkTable(filtered);
    };

    // Enable update button when a park is selected
    $(document).on("change", "input[name='selectedPark']", function () {
      selectedPark = $(this).val();
      $("#updateParkBtn").prop("disabled", !selectedPark);
    });

$("#updateParkBtn").on("click", function () {
  const park = allParks.find(p => Number(p.parkId) === Number(selectedPark));
  if (park) {
    $("#updateParkId").val(Number(park.parkId));
    $("#updateName").val(park.name);
    $("#updateState").val(park.state);
    $("#updateRegion").val(park.region);
    $("#updateAddress").val(park.address);
    $("#updatePhone").val(park.phone);
    $("#updateTrailLengthMiles").val(Number(park.trailLengthMiles) || 0);
    $("#updateDifficulty").val(park.difficulty);
    $("#updateDayPassPriceUsd").val(Number(park.dayPassPriceUsd) || 0);
    $("#updateMaxVisitors").val(Number(park.maxvisitors) || 0);
    $("#updateCurrentVisitors").val(Number(park.currentvisitors) || 0);
    $("#updateCurrentVisitorsAdults").val(Number(park.currentvisitorsadults) || 0);
    $("#updateCurrentVisitorsChildren").val(Number(park.currentvisitorschildren) || 0);
    $("#updateMaxCampsites").val(Number(park.maxcampsites) || 0);
    $("#updateTrailMapUrl").val(park.trailmapurl);
    $("#updateParkLogoUrl").val(park.parklogourl);
  }
});

    // Handle Add Park form submission
    $("#addParkForm").on("submit", function (e) {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(this));
      $.ajax({
        url: "https://gridactions3b.547bikes.info/api/Parks",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: () => location.reload(),
        error: () => alert("Error adding park")
      });
    });

// Handle Update Park form submission
$("#updateParkForm").on("submit", function (e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this));
  console.log(data); // ✅ Log the data before sending

  $.ajax({
    url: `https://gridactions3b.547bikes.info/api/Parks/${data.parkId}`,
    method: "PUT",
    contentType: "application/json",
    data: JSON.stringify(data),
    success: () => location.reload(),
    error: () => alert("Error updating park")
  });
});

$("#deleteParkBtn").on("click", function () {
  if (!selectedPark) return;

  const confirmed = confirm("Are you sure you want to delete this park?");
  if (!confirmed) return;

  $.ajax({
    url: `https://gridactions3b.547bikes.info/api/Parks/${selectedPark}`,
    method: "DELETE",
    success: () => {
      alert("Park deleted successfully.");
      location.reload();
    },
    error: () => {
      alert("Error deleting park.");
    }
  });
});




$(document).on("change", "input[name='selectedPark']", function () {
  selectedPark = $(this).val();
  $("#updateParkBtn").prop("disabled", !selectedPark);
  $("#deleteParkBtn").prop("disabled", !selectedPark); // Enable delete button
});

</script>
 
  <!-- Footer -->
  <footer class="footer text-center mt-5">
    &copy; Cocky Consulting 2025. <br> All rights reserved.<br>
    <a href="sitemap.html" class="sitelink">SiteMap</a>
  </footer>
</body>
</html>