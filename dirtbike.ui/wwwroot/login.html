<!DOCTYPE html>
<html lang="en">
<head>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="login.css" />
  <link rel="stylesheet" href="dropmenu.css" />
  <script src="./js/bikes.js"></script>
  <title>547Parks - BasicLogin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<style>
#userGreeting
{
text-align: center;
vertical-align: middle;
color: white;
}
#banner
{
background-color: lightgrey;
height: 60px;
vertical-align: middle;
width: 100%;
}

#cancelBtn
{
width: 400px;
}

#splash
{
font-size: 12pt;
}
  
#registernow
{
margin-top: 10px;
}

#sociallogin
{
margin-top: 10px;
}

#azurelogin
{
margin-top: 10px;
}

#forgotit
{
margin-top: 10px;
}
  
#somehelp
{
margin-top: 10px;
}

body {
  background-image: url('images/banff.jpg'); /* path to your image */
  background-size: cover;       /* scale image to cover entire area */
  background-repeat: no-repeat; /* prevent tiling */
  background-position: center;  /* center the image */
}
                
</style>
</head>
<body onload="checkUserStatus(); displayProfilePicture();">
    <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="index.html">Site Home</a>
                  <a href="cartreview.html">MyCart</a>
                  <a href="parks5.html">Review Park Options</a>
                  <a href="parksreview5.html">Park Reviews</a>
                  <a href="mybookings5.html">MyReservations</a>
                  <a href="manager.html">Manager Utilities</a>
             </div>
    </div> 
              <div class="logo">&nbsp&nbsp<H5>MyLinkv25<H5></div>
      </div>
      <div class="nav-right">
        <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='profile.html'" />
        <span id="H3UserBanner"></span>
        <a href="login.html" id="loginBtn" class="btn secondary-btn" onclick="loginUser(event)">Login</a>
        <a href="login.html" id="logoutBtn" class="btn secondary-btn" onclick="logoutUser(event)">Logout</a>
      </div>
    </div>
<div align="center" id="banner"><span id="userGreeting">Welcome Guest</span></div>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-4">
        <div class="card shadow">
          <div class="card-body">
            <h4 class="card-title text-center mb-4">Login</h4>
            <form id="loginForm">
              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" id="username" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" id="password" class="form-control" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">Login</button>
              <button id="registernow" class="btn btn-secondary w-100" onclick="callregister();">590Register</button>
              <button id="somehelp" class="btn btn-info w-100" onclick="callhelp();">590Care</button>
              <button id="forgotit" class="btn btn-warning w-100" onclick="callforgot();">590Forgot</button>
              <button id="azurelogin" class="btn btn-success w-100" onclick="call590();">590Login</button>
              <button id="sociallogin" class="btn btn-danger w-100" onclick="callgasocial();">GASocialLogin</button>
              </form>
            <div id="message" class="mt-3 text-center text-danger"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
   function callgasocial()
   {
   window.open("https://gl1.glocation.info/sso/glilogin/joomindex.html", "_self");
   }
    
   function call590()
   {
   window.open("login590.html", "_self");
   }
   function callregister()
   {
   window.open("register.html", "_self");
   }
   function callforgot()
   {
   window.open("forgotpassword.html", "_self");
   }
  function callhelp()
   {
   window.open("help.html", "_self");
   }
    
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;

  try {
    const response = await fetch('https://parksapi.547bikes.info/api/User');
    const users = await response.json();

    const user = users.find(u => u.username === username && u.plainpassword === password);

    if (user) {
      for (const key in user) {
        const value = user[key];
        if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
          localStorage.setItem(key, value);
        } else {
          localStorage.setItem(key, JSON.stringify(value));
        }
      }
      localStorage.setItem("uid", user.id);
      localStorage.setItem("status", "loggedin");
      postUserSession();

      document.getElementById('message').textContent = 'Login successful!';
      document.getElementById('message').classList.remove('text-danger');
      document.getElementById('message').classList.add('text-success');

      window.location.href = "index.html";
    } else {
      document.getElementById('message').textContent = 'Invalid username or password.';
    }
  } catch (error) {
    document.getElementById('message').textContent = 'Error connecting to server.';
    console.error(error);
  }
});
  
  function postUserSession() {
  // Step 1: Retrieve values from localStorage
  const uid = localStorage.getItem('uid');
  const fullname = localStorage.getItem('fullname');
  const email = localStorage.getItem('email');

  // Step 2: Generate a random string (3 letters + 6 digits)
  const randomAlpha = Array.from({ length: 3 }, () =>
    String.fromCharCode(65 + Math.floor(Math.random() * 26))
  ).join('');
  const randomNumber = Math.floor(100000 + Math.random() * 900000);
  const randomString = `${randomAlpha}${randomNumber}`;

  // Step 3: Construct the payload
  const payload = {
    userid: uid,
    sessionfullname: fullname,
    sessionemail: email,
    token: randomString
  };

  // Step 4: Send POST request
  fetch('https://parksapi.547bikes.info/api/usersession', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  })
    .then(response => {
      if (!response.ok) throw new Error('Network response was not ok');
      return response.json();
    })
    .then(data => {
      console.log('Session posted successfully:', data);
    })
    .catch(error => {
      console.error('Error posting session:', error);
    });
}
  </script>
</body>
<footer class="footer"> &copy; Cocky Consulting 2025. <br> All rights reserved.<br>  <span align="center"><a href="sitemap.html" class="sitelink">SiteMap</a></span></footer>
</html>
