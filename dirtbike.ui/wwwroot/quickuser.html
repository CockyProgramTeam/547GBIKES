<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quick User Add</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Quick User Add</h4>
        </div>

        <div class="card-body">
            <form id="quickUserForm">

                <!-- Username -->
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>

                <!-- Fullname -->
                <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="fullname" required>
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" required>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="plainpassword" required>
                </div>

                <!-- Role -->
                <div class="mb-3">
                    <label class="form-label">Role</label>
                    <input type="text" class="form-control" id="role" required>
                </div>

                <!-- Address Fields -->
                <h5 class="mt-4">Address</h5>

                <div class="mb-3">
                    <label class="form-label">Address 1</label>
                    <input type="text" class="form-control" id="address1">
                </div>

                <div class="mb-3">
                    <label class="form-label">Address 2</label>
                    <input type="text" class="form-control" id="address2">
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" id="city">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">State/Region</label>
                        <input type="text" class="form-control" id="stateregion">
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">Postal/Zip</label>
                        <input type="text" class="form-control" id="postalzip">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Country</label>
                    <input type="text" class="form-control" id="country">
                </div>

                <!-- Contact -->
                <h5 class="mt-4">Contact</h5>

                <div class="mb-3">
                    <label class="form-label">Phone</label>
                    <input type="text" class="form-control" id="phone">
                </div>

                <div class="mb-3">
                    <label class="form-label">Cellphone</label>
                    <input type="text" class="form-control" id="cellphone">
                </div>

                <!-- Picture Upload -->
                <h5 class="mt-4">Profile Picture</h5>

                <div class="mb-3">
                    <label class="form-label">Upload Picture</label>
                    <input type="file" class="form-control" id="pictureUpload" accept="image/*">
                </div>

                <div class="mb-3">
                    <img id="previewImage" src="" class="img-thumbnail d-none" style="max-width: 200px;">
                </div>

                <!-- Hidden field for Activepictureurl -->
                <input type="hidden" id="activepictureurl">

                <button type="submit" class="btn btn-success w-100">Create User</button>
            </form>

            <div id="result" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    // Preview uploaded picture
    document.getElementById("pictureUpload").addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
            const img = document.getElementById("previewImage");
            img.src = e.target.result;
            img.classList.remove("d-none");

            // Store base64 in hidden field
            document.getElementById("activepictureurl").value = e.target.result;
        };
        reader.readAsDataURL(file);
    });

    // Submit form
    document.getElementById("quickUserForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        const dto = {
            username: document.getElementById("username").value,
            fullname: document.getElementById("fullname").value,
            email: document.getElementById("email").value,
            plainpassword: document.getElementById("plainpassword").value,
            role: document.getElementById("role").value,

            address1: document.getElementById("address1").value,
            address2: document.getElementById("address2").value,
            city: document.getElementById("city").value,
            stateregion: document.getElementById("stateregion").value,
            postalzip: document.getElementById("postalzip").value,
            country: document.getElementById("country").value,

            phone: document.getElementById("phone").value,
            cellphone: document.getElementById("cellphone").value,

            activepictureurl: document.getElementById("activepictureurl").value
        };

        const response = await fetch("/api/Template/quickadd", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dto)
        });

        const resultDiv = document.getElementById("result");

        if (response.ok) {
            resultDiv.innerHTML = `<div class="alert alert-success">User created successfully</div>`;
        } else {
            resultDiv.innerHTML = `<div class="alert alert-danger">Error creating user</div>`;
        }
    });
</script>

</body>
</html>
