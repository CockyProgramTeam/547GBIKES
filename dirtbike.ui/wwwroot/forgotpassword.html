<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="login.css" />
<link rel="stylesheet" href="forgotpassword.css" />
<link rel="stylesheet" href="dropmenu.css" />
<script src="./js/bikes.js"></script>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>  
  
  <title>ForgotPassword</title>
</head>
<body>
  <!-- Navigation Bar -->
  <div class="navbar">
    <div class="nav-left">
      <div class="dropdown">
        <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
        <div class="dropdown-content">
          <a href="index.html">Site Home</a>
          <a href="cartreview.html">MyCart</a>
          <a href="parks5.html">Review Park Options</a>
          <a href="parksreview5.html">Park Reviews</a>
          <a href="mybookings5.html">MyReservations</a>
          <a href="manager.html">Manager Utilities</a>
        </div>
      </div> 
      <div class="logo">&nbsp;&nbsp;<h5>MyLinkv25</h5></div>
    </div>
    <div class="nav-right">
      <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='profile.html'" />
      <span id="H3UserBanner"></span>
      <a href="login.html" id="loginBtn" class="btn secondary-btn" onclick="loginUser(event)">Login</a>
      <a href="login.html" id="logoutBtn" class="btn secondary-btn" onclick="logoutUser(event)">Logout</a>
      <a href="cartreview.html" id="cartBtn3"><img src="./images/cart4.png" width="40px" height="40px"></a>
    </div>
  </div>
  <div align="center" id="banner"><span id="userGreeting">Welcome Guest</span></div>

    <!-- Forgot Password Section -->
    <div class="forgot-password-page">
      <div class="forgot-password-container">
        <h2>Reset Your Password</h2>
        <p>Enter your email address below, and we'll send you a link to reset your password.</p>
        <form id="forgotPasswordForm">
          <input type="email" id="email" placeholder="Email Address" required>
          <button type="submit">Send Reset Link</button>
        </form>
        <a href="login.html">Back to Login</a>
      </div>
    </div>

    <script>
      // Handle forgot password form submission
      document.getElementById('forgotPasswordForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent form from submitting the traditional way

        const email = document.getElementById('email').value;
        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/; // Regex for validating email format

        if (!email) {
          alert('Please enter your email address');
          return;
        }

        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address');
          return;
        }

        try {
          // Step 1: Check if the email exists for any User
          const userCheckResponse = await fetch('https://cockyapiv3-bugudue8akcsbacz.westus3-01.azurewebsites.net/api/Users', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
          });

          if (!userCheckResponse.ok) throw new Error('Failed to fetch users');

          const users = await userCheckResponse.json();
          const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());

          if (!user) {
            alert('No account found with that email address.');
            return;
          }

          // Step 2: If user exists, send the reset password request
          const forgotPasswordResponse = await fetch('https://cockyapiv3-bugudue8akcsbacz.westus3-01.azurewebsites.net/api/Auth/forgotPassword', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ Email: email })
          });

          const data = await forgotPasswordResponse.json();

          if (forgotPasswordResponse.ok) {
            alert('A password reset link has been sent to your email!');
          } else {
            alert(data.message || 'Failed to send reset link');
          }
        } catch (error) {
          alert('Error: ' + error.message);
        }
      });
    </script>
</body>
</html>

