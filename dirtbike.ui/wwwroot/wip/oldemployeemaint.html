<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="home.css" />
  <title>Employee Directory</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body onload="checkUserStatus()">
  <div class="navbar">
    <div class="nav-left">
      <div class="logo">Employee Directory</div>
    </div>
    <div class="nav-right">
      <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='profile.html'" />
      <span id="H3UserBanner">User</span>
    </div>
  </div>

  <div class="container py-5">
    <h1 class="mb-4 text-center">Employees</h1>

    <div class="mb-4 text-center">
      <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">Add Employee</button>
      <button class="btn btn-warning" id="updateEmployeeBtn" disabled data-bs-toggle="modal" data-bs-target="#updateEmployeeModal">Update Selected Employee</button>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>Name</th>
            <th>Birthdate</th>
            <th>Employee ID</th>
            <th>UID</th>
            <th>Address 1</th>
            <th>Address 2</th>
            <th>City</th>
            <th>State</th>
            <th>ZIP</th>
          </tr>
        </thead>
        <tbody id="employee-table-body"></tbody>
      </table>
    </div>
  </div>

  <!-- Add Employee Modal -->
  <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="addEmployeeForm">
          <div class="modal-header">
            <h5 class="modal-title">Add New Employee</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body row g-3">
            <div class="col-md-6"><label class="form-label">Name</label><input type="text" name="name" class="form-control" required></div>
            <div class="col-md-6"><label class="form-label">Birthdate</label><input type="date" name="birthdate" class="form-control" required></div>
            <div class="col-md-6"><label class="form-label">Address 1</label><input type="text" name="address1" class="form-control"></div>
            <div class="col-md-6"><label class="form-label">Address 2</label><input type="text" name="address2" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">City</label><input type="text" name="city" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">State</label><input type="text" name="state" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">ZIP</label><input type="text" name="zip" class="form-control"></div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Update Employee Modal -->
  <div class="modal fade" id="updateEmployeeModal" tabindex="-1" aria-labelledby="updateEmployeeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="updateEmployeeForm">
          <div class="modal-header">
            <h5 class="modal-title">Update Employee</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body row g-3">
            <input type="hidden" name="uid" id="updateUid">
            <div class="col-md-6"><label class="form-label">Name</label><input type="text" name="name" id="updateName" class="form-control" required></div>
            <div class="col-md-6"><label class="form-label">Birthdate</label><input type="date" name="birthdate" id="updateBirthdate" class="form-control" required></div>
            <div class="col-md-6"><label class="form-label">Address 1</label><input type="text" name="address1" id="updateAddress1" class="form-control"></div>
            <div class="col-md-6"><label class="form-label">Address 2</label><input type="text" name="address2" id="updateAddress2" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">City</label><input type="text" name="city" id="updateCity" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">State</label><input type="text" name="state" id="updateState" class="form-control"></div>
            <div class="col-md-4"><label class="form-label">ZIP</label><input type="text" name="zip" id="updateZip" class="form-control"></div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-warning">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let allEmployees = [];
    let selectedUid = null;

    $(document).ready(function () {
      $.get("https://gridactions3b.547bikes.info/api/Employee", function (employees) {
        allEmployees = employees;
        const tbody = $("#employee-table-body");
        employees.forEach(emp => {
          const row = `
            <tr>
              <td><input type="radio" name="selectedEmployee" value="${emp.uid}"></td>
              <td>${emp.name}</td>
              <td>${emp.birthdate}</td>
              <td>${emp.employeeId}</td>
              <td>${emp.uid}</td>
              <td>${emp.address1}</td>
              <td>${emp.address2}</td>
              <td>${emp.city}</td>
              <td>${emp.state}</td>
              <td>${emp.zip}</td>
            </tr>
          `;
          tbody.append(row);
        });
      });

      $(document).on("change", "input[name='selectedEmployee']", function () {
        selectedUid = $(this).val();
        $("#updateEmployeeBtn").prop("disabled", !selectedUid);
      });

      $("#updateEmployeeBtn").on("click", function () {
        const emp = allEmployees.find(e => e.uid === selectedUid);
        if (emp) {
          $("#updateUid").val(emp.uid);
          $("#updateName").val(emp.name);
          $("#updateBirthdate").val(emp.birthdate);
          $("#updateAddress1").val(emp.address1);
          $("#updateAddress2").val(emp.address2);
          $("#updateCity").val(emp.city);
          $("#updateState").val(emp.state);
          $("#updateZip").val(emp.zip);
        }
      });

      $("#addEmployeeForm").on("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        $.ajax({
          url: "https://gridactions3b.547bikes.info/api/Employee",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify(data),
          success: () => location.reload(),
          error: () => alert("Error adding employee")
        });
      });

      $("#updateEmployeeForm").on("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this));
        $.ajax({
          url: `https://gridactions3b.547bikes.info/api/Employee/${data.uid}`,
          method: "PUT",
          contentType: "application/json",
          data: JSON.stringify(data),
          success: () => location.reload(),
          error: () => alert("Error updating employee")
        });
      });
    });
  </script>

  <!-- Footer -->
  <footer class="footer text-center mt-5">
    &copy; Cocky Consulting 2025. <br> All rights reserved.<br>
    <a href="sitemap.html" class="sitelink">SiteMap</a>
  </footer>
</body>
</html>
