<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EIS Admin Home</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="adminhome.css" />
  <link rel="stylesheet" href="dropmenu.css" />
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<style>
 .jsmenu {
  padding: 0;
  margin: 0;
  border: none;
  background: none;
  width: 50px;
  height: 50px;
  display: inline-block;
}

.jsmenu img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover; /* Optional: ensures image fills the button */
  border: none;
}

.jsfooterextension
{
  display: flex;
  justify-content: center;   /* Horizontal alignment */
  align-items: center;       /* Vertical alignment */
  background-color: grey;
  max-height: 250px;
  height: 250px;
  font-size: 8pt;
}

</style>
</head>


<body onload="checkUserStatus(); displayProfilePicture(); writelocation();">
 <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="..\employeehome.html">Employee Home</a>
                  <a href="adminhome.html">EmployeeAdmin</a>
                  <a href="adminservices.html">ServicesAdmin</a>
                  <a href="whitelabeladmin.html">WhiteLabelAdmin</a>
                  <a href="adminstuff.html">Admin Tools</a>
                  <a href="..\certs\adminmycerts.html">Admin MyCerts</a>
                  <a href="..\corp\corporatevents.html">Corporate Events</a>
            </div>
    </div> 
         <div class="logo" align="left">&nbsp&nbspGEM EISPRO</div>  
      </div>
      <div class="nav-right">
          <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='../profile.html'" width="30px" height="30px"/> 
          <span id="H3UserBanner">User</span>
          <button id="logoutBtn" onclick="onLogout(event)">Logout</button>
        </div>
      </div>
  <!-- Features Section -->
   <section class="features">
      <p>Exec Functions&nbsp&nbsp</p>
      <div class="feature">
        <a href="../certs/adminmycerts.html">
          <img src="./images/AdministratorCerts.png" width=60px height=60px>
          <h3>Admin Certifications</h3>
          <p>Manage and update your personal certifications.</p>
        </a>
      </div>
      <div class="feature">
        <a href="../certs/teamcerts.html">
          <img src="./images/TeamTraining.png" width=60px height=60px>
          <h3>Review Team Achievements</h3>
          <p>Monitor team progress.</p>
        </a>
      </div>
       <div class="feature">
        <a href="../dashboard/eis.html">
          <img src="./images/EISLOGO.png" width=60px height=60px>
          <h3>Executive Information Services</h3>
          <p>Review Grid Instance Details.</p>
        </a>
      </div>
      <div class="feature">
        <a href="../certs/certcat.html">
          <img src="./images/Sears.png" width=60px height=60px>
          <h3>Certificate Catalogue</h3>
          <p>
            Administer System certification options.
          </p>
        </a>
      </div>
    </section>
    <section class="features">
      <p>Grid Admin&nbsp&nbsp</p>
      <div class="feature">
        <a href="../celearn/celearn.html">
          <img src="./images/MyLearning.jpeg" width=60px height=60px>
          <h3>My Learning</h3>
          <p>Corporate Training Portal For Target Technologies.</p>
        </a>
      </div>
      <div class="feature" style="color:black;">
        <a href="adminstuff.html">
          <img src="./images/AdminTools.jpeg" width=60px height=60px>
          <h3>Administrator Tools</h3>
          <p>
            HR & Core Business Unit & Sales Admin Tools.
          </p>
        </a>
      </div>
          <div class="feature">
        <a href="admingrid.html">
          <img src="./images/gridicon.jpg" width=60px height=60px>
          <h3>Grid Admin</h3>
          <p>Manage Grids, Grid Applications & Grid Services.</p>
        </a>
      </div>
      <div class="feature" style="color:black;">
        <a href="adminhosting.html">
          <img src="./images/hosting.jpg" width=60px height=60px>
          <h3>Hosting Admin</h3>
          <p>
            Manage WebApps & Svcs, Wholesale Accounts, Regions.
          </p>
        </a>
      </div>
    </section>
      <section class="features">
        <p>User Admin &nbsp&nbsp</p>
      <div class="feature" style="color:black;">
      <a href="#" onclick="showAdminCertUpload(); return false;">
      <img src="./images/batch.png" width=60px height=60px>
      <h3>Add User Certs By Batch</h3>
      <p>Upload a batch of certifications.</p>
      </a>
    </div>
    <!-- Add Employees -->
    <div class="feature" style="color:black;">
      <a href="#" onclick="showAdminEmployeeUpload(); return false;">
      <img src="./images/batchusers.jpg" width=60px height=60px>
      <h3>Add Employees By Batch</h3>
      <p>Upload a batch of employee data.</p>
      </a>
    </div>
      <!-- Add Employees -->
    <div class="feature" style="color:black;">
      <a href="../employees/employeecreate.html" target="self">
      <img src="./images/emp.png" width=60px height=60px>
      <h3>Add Employees Manually</h3>
      <p>Manually Add an Employee</p>
      </a>
    </div>
    <div class="feature" style="color:black;">
      <a href="../employees/employeecreate.html" target="self">
      <img src="./images/usericon.png" width=60px height=60px>
        <h3>Add ISP Users Manually</h3>
      <p>Manually Add an ISP User</p>
      </a>
    </div>
    </section>
      </container>
    </div>
  </div>
  <!-- hidden upload form for certs -->
  <div id="uploadCertFormAdmin">
    <h5>Upload a Certification File</h5>
    <input type="file" id="adminCertFile" accept=".pdf,.jpg,.png" />
    <button class="btn btn-success btn-block" onclick="uploadAdminCertFile()">
      Upload Cert
    </button>
  </div>

  <!-- hidden upload form for employees -->
  <div id="uploadEmployeeFormAdmin">
    <h5>Upload an Employee File</h5>
    <input type="file" id="adminEmployeeFile" accept=".csv,.xlsx,.pdf" />
    <button class="btn btn-success btn-block" onclick="uploadAdminEmployeeFile()">
      Upload Employees
    </button>
  </div>
 <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <h2>Welcome, Administrator!</h2>
      <p>Manage Teams, Add Users, Visit EIS Home, Review logs.</p>
    </div>
  </div>
  <!-- Logs Section -->
  <div class="logsheader" id="logheader" align="center">
    <hr />
    <h5>Administrator Details</h5>
    <hr />
  </div>
  <div class="jrow">
    <div class="jcolumn">
      <button class="accordion" onclick="fetchSyslog()">
        Security Actions and Logs (+/-)
      </button>
      <div class="panel" style="background-color:#aaa;">
        <p id="syslogDisplay">Security Logs Will Be Displayed Here</p>
      </div>
    </div>
     <div class="jcolumn">
      <button class="accordion" onclick="fetchApilog()">
        API Actions and Logs (+/-)
      </button>
      <div class="panel" style="background-color:#bbb;">
        <p id="apilogDisplay">ApiLogs Will Be Displayed Here.</p>
      </div>
    </div>
  </div>
    <div class="jrow">
    <div class="jcolumn">
      <button class="accordion" onclick="fetchLearnlog()">
        Learn Actions and Logs (+/-)
      </button>
      <div class="panel" style="background-color:#ccc;">
        <p id="learnlogDisplay">LearnLogs Will Be Displayed Here</p>
      </div>
    </div>
      <div class="jcolumn">
      <button class="accordion" onclick="fetchSessionlog()">
        UserSessions (+/-)
      </button>
      <div class="panel" style="background-color:#ccc;">
        <p id="sessionlogDisplay">SessionLogs Will Be Displayed Here</p>
      </div>
    </div>
  </div>


  <div id="userModal" style="display:none; position:fixed; top:20%; left:35%; background:#fff; border:1px solid #ccc; padding:20px;">
  <h3>Create New User</h3>
  <label>Username: <input type="text" id="username"></label><br>
  <label>Full Name: <input type="text" id="fullname"></label><br>
  <label>Password: <input type="password" id="plainpassword"></label><br>
  <label>Employee: 
    <select id="employee">
      <option value="1">Yes</option>
      <option value="0">No</option>
    </select>
  </label><br><br>
  <button onclick="submitUser()">Submit</button>
</div>
  <script>
    const certsUploadUrl =
      "https://gridactions3b.capitoltechnology.net/api/File/upload?fileCategory=certs";
    const employeesUploadUrl =
      "https://gridactions3b.capitoltechnology.net/api/File/upload?fileCategory=employees";

    function showAdminCertUpload() {
      document.getElementById("uploadCertFormAdmin").style.display = "block";
    }
    async function uploadAdminCertFile() {
      const fileInput = document.getElementById("adminCertFile");
      if (!fileInput.files.length) {
        return alert("Please select a file to upload.");
      }
      const fd = new FormData();
      fd.append("file", fileInput.files[0]);
      try {
        const res = await fetch(certsUploadUrl, {
          method: "POST",
          body: fd,
        });
        const json = await res.json();
        if (!json.blobUrl) throw new Error("No blobUrl returned");
        alert("Upload successful:\n" + json.blobUrl);
        fileInput.value = "";
        document.getElementById("uploadCertFormAdmin").style.display = "none";
      } catch (err) {
        console.error("Upload error:", err);
        alert("Upload failed: " + err.message);
      }
    }

    function showAdminEmployeeUpload() {
      document.getElementById("uploadEmployeeFormAdmin").style.display = "block";
    }
    async function uploadAdminEmployeeFile() {
      const fileInput = document.getElementById("adminEmployeeFile");
      if (!fileInput.files.length) {
        return alert("Please select a file to upload.");
      }
      const fd = new FormData();
      fd.append("file", fileInput.files[0]);
      try {
        const res = await fetch(employeesUploadUrl, {
          method: "POST",
          body: fd,
        });
        const json = await res.json();
        if (!json.blobUrl) throw new Error("No blobUrl returned");
        alert("Upload successful:\n" + json.blobUrl);
        fileInput.value = "";
        document.getElementById("uploadEmployeeFormAdmin").style.display = "none";
      } catch (err) {
        console.error("Upload error:", err);
        alert("Upload failed: " + err.message);
      }
    }

    function checkUserStatus() {
      const userId = localStorage.getItem("uid"),
        fullName = localStorage.getItem("fullname");
      if (userId && userId !== "901") {
        document.getElementById("H3UserBanner").innerText = fullName;
      } else {
        document.getElementById("H3UserBanner").innerText = "Guest";
        document.getElementById("userProfilePic").src =
          "./images/bluecircle.png";
      }
    }

    function checkUserRole() {
      const userRole = localStorage.getItem("role");
      if (userRole != "superuser") {
        document.getElementById("manager").style.display = "none";
      }
    }

    function fetchProfilePicture() {
      const uid = localStorage.getItem("uid");
      $.get(
        "https://gemroot-d3h6hybke9c4f0fr.centralus-01.azurewebsites.net/api/Userprofile"
      )
        .done(function (profiles) {
          const profile = profiles.find((p) => p.userid == uid);
          if (profile && profile.activepictureurl) {
            $("#userProfilePic").attr("src", profile.activepictureurl);
          }
        })
        .fail(function (xhr) {
          console.error("Error fetching profiles:", xhr.responseText);
        });
    }

    function fetchSyslog() {
      $.get(
        "https://gridactions3b.capitoltechnology.net/api/Userlog"
      )
        .done((data) => $("#syslogDisplay").text(JSON.stringify(data, null, 2)))
        .fail(() => $("#syslogDisplay").text("Error fetching syslog"));
    }
    function fetchSessionlog() {
      $.get(
        "https://gridactions3b.capitoltechnology.net/api/Usersession"
      )
        .done((data) => $("#sessionlogDisplay").text(JSON.stringify(data, null, 2)))
        .fail(() => $("#sessionlogDisplay").text("Error fetching syslog"));
    }
    function fetchApilog() {
      $.get(
        "https://gridactions3b.capitoltechnology.net/api/Useraction"
      )
        .done((data) => $("#apilogDisplay").text(JSON.stringify(data, null, 2)))
        .fail(() => $("#apilogDisplay").text("Error fetching apilog"));
    }
    function fetchLearnlog() {
      $.get(
        "https://gridactions3b.capitoltechnology.net/api/Learndetail"
      )
        .done((data) =>
          $("#learnlogDisplay").text(JSON.stringify(data, null, 2))
        )
        .fail(() => $("#learnlogDisplay").text("Error fetching learnlog"));
    }
    
    function displayProfilePicture()
    {
        var newSrc = './images/bluecircle.png'; 
        const imageElement = document.getElementById("profilephototarget");

      const tempSrc = localStorage.getItem("activepictureurl");
      if (tempSrc !== null) {
          newSrc = tempSrc;
          alert(newSrc);
        } 
      else {
            // Do Nothing.... Blue Circle will show.
        }
         imageElement.src = newSrc;
    }
    
  function submitUser() {
  const data = {
    username: document.getElementById("username").value,
    fullname: document.getElementById("fullname").value,
    plainpassword: document.getElementById("plainpassword").value,
    employee: parseInt(document.getElementById("employee").value)
  };

  fetch("https://gridactions3b.capitoltechnology.net/api/users", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(result => {
    alert("User created successfully!");
    document.getElementById("userModal").style.display = "none";
  })
  .catch(error => {
    alert("Error creating user.");
    console.error(error);
  });
}
  
        
    function onLogout(event) {
      event.preventDefault();
      localStorage.clear();
      localStorage.setItem("uid", "901");
      localStorage.setItem("fullname", "Guest");
      localStorage.setItem("role", "guest");
      localStorage.setItem("isemployee", "0");
      window.location.replace("../login.html");
    }

    //JOHNS ACCORDIAN SCRIPTS DO NOT TOUCH OR THIS WONT WORK.... 
    var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
  acc[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var panel = this.nextElementSibling;
    if (panel.style.display === "block") {
      panel.style.display = "none";
    } else {
      panel.style.display = "block";
    }
  });
}
 function writelocation()
    {
    const locElement = document.getElementById("locationbar");
    const ipElement = document.getElementById("ipbar");
    //var somelat = localStorage.getItem("LAT");
    //var somelong = localStorage.getItem("LONG");
    somefulllocation = localStorage.getItem("userlocation");
    someipaddress = localStorage.getItem("ipaddress");
    //var fulllocation = somelong + "," + somelat;

 if (somefulllocation) {
        //const fullLocation = `${somelat},${somelong}`;
        locElement.innerHTML = `Your Location is: ${somefulllocation}`;
        ipElement.innerHTML = `Your IP is: ${someipaddress}`;
    } else {
        locElement.innerHTML = "Location data not available.";
        ipElement.innerHTML = `Your IP address is not available.`;
    }
}
  </script>
</body>
    <!-- Footer -->
  <footer class="footer"> 
     <!-- Hero Section -->

    
    
    &copy;Capitol Technology Solutions, Raleigh, NC. <br> All rights reserved.<br>  <span align="center"><a href="sitemap.html" class="sitelink">SiteMap</a></span><BR><span align="center" id="locationbar"></span><BR><span align="center" id="ipbar"></span></footer>
