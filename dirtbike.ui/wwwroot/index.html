<!DOCTYPE html>
<head>
<html lang="en">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="login.css" />
<link rel="stylesheet" href="dropmenu.css" />
<script src="./js/bikes.js"></script>
<title>MyLink25 - Your Outdoor Adventure Source</title>
<style>
#userGreeting
{
text-align: center;
vertical-align: middle;
color: yellow;
}
#banner
{
background-color: lightgrey;
height: 60px;
vertical-align: middle;
width: 100%;
}

#cancelBtn
{
width: 400px;
}

#splash
{
font-size: 12pt;
}
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-box {
      background: #fff;
      width:70%;   /* wide */
      height: 70px;   /* slim height */
      padding: 10px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: Arial, sans-serif;
	  position: absolute;
	  top: 125px;
	  margin-left: auto 0;
	  font-size: 8pt;
	  background: transparent;
    }

    .popup-box input {
      margin: 0 10px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .popup-actions button {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #0078d7;
      color: #fff;
      cursor: pointer;
    }

    .popup-actions button:hover {
      background: #005fa3;
    }
	
#travelBox {
  position: absolute;   /* or fixed if you want it pinned */
  top: 150px;
  background: #bfc1c2;
  padding: 20px;
  width: 240px;
  max-width: 25%;
  font-size: 8pt;
  height: 120px;
  left: 85%;
  padding: 10px 20px;
  color: peachpuff;
  box-shadow: 5px 5px 10px rgba(0,0,0,0.3),
              -5px -5px 10px rgba(255,255,255,0.6);
  padding: 20px;
  opacity: 0.9; /* 10% visible, 90% transparent */
}

	#travelBox a
	{
	color: peach;
	}
	#travelBox a:visited
	{
	color: peach;
	}
	#travelBox p
	{
	color: peach;
	}

	
</style>
</head>

<body onload="checkUserStatus(); displayProfilePicture();">
    <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="about.html">About</a>
                  <a href="index.html">SiteHome</a>
                  <a href="cartreview.html">MyCart</a>
                  <a href="parks5.html">BookParks</a>
                  <a href="parksreview5.html">ParkReviews</a>
                  <a href="mybookings5.html">MyReservations</a>
                  <a href="manager.html">ManagerTools</a>
                  <a href="utilities.html">Utilities</a>
            	  </div>
	    </div>
      <div class="logo">&nbsp&nbsp<H5>MyLinkv25</H5></div>
      </div>


      <div class="nav-right">
        <img src="./images/bluecircle.png" id="profilephototarget" alt="User" style="cursor:pointer;" onclick="window.location.href='profile.html'" />
        <span id="H3UserBanner"></span>
        <a href="login.html" id="loginBtn" onclick="loginUser(event)">Login</a>
        <a href="login.html" id="logoutBtn" onclick="logoutUser(event)">Logout</a>
        <a href="cartreview.html" id="cartBtn3"><img src="./images/cart4.png" width="40px" height="40px"></a>
      </div>
    </div>
  <div align="center" id="banner" style="height: 60px;"><span id="userGreeting">Welcome Guest</span></div>
  
  <!-- WhiteLabel Branding Image -->  
  <div align="center" class="homeimagepane"><span align="center"><p align="center"><img src="./images/gauley.jpg" width="100%" height="375px"></p></span></div>
  
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
       <h2>Welcome to MyLink</h2>
      <p id="splash">Your one-stop solution for Motocross, Camping, Biking, & Outdoor Recreation!</p>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features">
    <div class="container">
    <div class="feature">
       <span><img src="./images/reserve.png" width="40px" height="40px"/></span> 
    	<a href="mybookings5.html">
          <h3>Check your Reservations</h3>
          <p>Stay up-to-date on your recent Reservations!</p>
        </a>
      </div>
      
        <div class="feature">
        <span><img src="./images/motocross.png" width="40px" height="40px"/></span>
        <a href="moto5.html">
          <h3>Review Motorcross Parks</h3>
          <p>Explore Heavy Duty Cycling in the Carolinas, Texas and Idaho</p>
        </a>
      </div>  
    <div class="feature">
       <span><img src="./images/camping.png" width="40px" height="40px"/></span>
        <a href="parks5.html">
          <h3>Review Parks</h3>
          <p>Explore Mountain Biking & Outdoor Opportunities on the East Coast in the Carolinas, West Virginia, Delaware and Maryland.</p>
        </a>
      </div>
    
    <div class="feature">
       <span><img src="./images/ballot.png" width="40px" height="40px"/></span>
        <a href="parksreview5.html">
          <h3>User Reviews</h3>
          <p>Explore recent customer feedback on parks and outdoor experiences.</p>
        </a>
      </div>
        <div class="feature">
        <span><img src="./images/parkview.png" width="40px" height="40px"/></span>
        <a href="parkvisualizations.html">
          <h3>Park Visualizations</h3>
          <p>Review US State and National Parks which support bikes, outdoor activities and camping.</p>
        </a>
      </div>    
    </div>
  </section>

  <div id="travelModal" class="modal-overlay">
    <div class="modal-box">
      <label>Destination:</label>
      <input type="text" id="mypick2" placeholder="City/State or Campground">
      <div class="modal-actions">
        <button id="findme" onclick="findmypark()">Find</button>
        <button id="closeModal" onclick="closeModal()">Close</button>
		<p>For a better search experience,<a href="login.html">Login</a> or <a href="register.html">Register</a></p>
      </div>
    </div>
  </div>

<div id="travelBox">
  <div id="destination"><label for="mypick">Destination:</label>
  <select id="mypick" name="mypick" class="form-select">
    <!-- US States -->
    <option value="AL">Alabama</option>
    <option value="AK">Alaska</option>
    <option value="AZ">Arizona</option>
    <option value="AR">Arkansas</option>
    <option value="CA">California</option>
    <option value="CO">Colorado</option>
    <option value="CT">Connecticut</option>
    <option value="DE">Delaware</option>
    <option value="FL">Florida</option>
    <option value="GA">Georgia</option>
    <option value="HI">Hawaii</option>
    <option value="ID">Idaho</option>
    <option value="IL">Illinois</option>
    <option value="IN">Indiana</option>
    <option value="IA">Iowa</option>
    <option value="KS">Kansas</option>
    <option value="KY">Kentucky</option>
    <option value="LA">Louisiana</option>
    <option value="ME">Maine</option>
    <option value="MD">Maryland</option>
    <option value="MA">Massachusetts</option>
    <option value="MI">Michigan</option>
    <option value="MN">Minnesota</option>
    <option value="MS">Mississippi</option>
    <option value="MO">Missouri</option>
    <option value="MT">Montana</option>
    <option value="NE">Nebraska</option>
    <option value="NV">Nevada</option>
    <option value="NH">New Hampshire</option>
    <option value="NJ">New Jersey</option>
    <option value="NM">New Mexico</option>
    <option value="NY">New York</option>
    <option value="NC">North Carolina</option>
    <option value="ND">North Dakota</option>
    <option value="OH">Ohio</option>
    <option value="OK">Oklahoma</option>
    <option value="OR">Oregon</option>
    <option value="PA">Pennsylvania</option>
    <option value="RI">Rhode Island</option>
    <option value="SC">South Carolina</option>
    <option value="SD">South Dakota</option>
    <option value="TN">Tennessee</option>
    <option value="TX">Texas</option>
    <option value="UT">Utah</option>
    <option value="VT">Vermont</option>
    <option value="VA">Virginia</option>
    <option value="WA">Washington</option>
    <option value="WV">West Virginia</option>
    <option value="WI">Wisconsin</option>
    <option value="WY">Wyoming</option>

    <!-- US Territories -->
    <option value="AS">American Samoa</option>
    <option value="GU">Guam</option>
    <option value="MP">Northern Mariana Islands</option>
    <option value="PR">Puerto Rico</option>
    <option value="VI">U.S. Virgin Islands</option>

    <!-- Additional Countries -->
    <option value="CA">Canada</option>
    <option value="MX">Mexico</option>
  </select></div>
  <BR><BR>
  <div class="popup-actions">
    <button id="findme" onclick="findmypark()">Find</button>
    <button id="closeBox" onclick="closeBox()">Close</button>
    <p>For a better search experience,
      <a href="login.html">Login</a> or <a href="register.html">Register</a>
    </p>
  </div>
</div>	
  <!-- JavaScript -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>

function findmypark() {
  let somestatepick = document.getElementById("mypick").value;
  alert("You picked: " + somestatepick + " Filtering the Park Selector");
  var someurl = "https://home.547bikes.info/parksbystate.html?state=" + somestatepick;
  window.open(someurl, "_self");
}

	  
  	function setdemouser()
    {
    var someuid = localStorage.getItem("uid");
    if(!someuid)
    {
  	alert("setting user for trial usage");
    localStorage.setItem("uid", "1");
    localStorage.setItem("fullname", "Park Guest");
    localStorage.setItem("email", "parkguest@547bikes.info");
    localStorage.setItem("role", "registered");
    localStorage.setItem("activepictureurl", "./images/parkguest.png");    
    }
    else
    {
    //Do Nothing existing user login.
    }
    }
    // API Endpoints
    const usersApiUrl = "https://parksapi.547bikes.info/api/Users";
    const profilesApiUrl = "https://parksapi.547bikes.info/api/Userprofile";

    function checkUserStatus() {
      var userId = localStorage.getItem("uid");
      var fullName = localStorage.getItem("fullname");
      var userRole = localStorage.getItem("role");

      var loginBtn = document.getElementById("loginBtn");
      var logoutBtn = document.getElementById("logoutBtn");

      if (userId && userId !== "901") {
        // Logged in
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        document.getElementById("H3UserBanner").innerText = fullName;
        document.getElementById("userGreeting").innerHTML = "Welcome, " + fullName; // Display full name

        if (userRole === "admin" || userRole == "superuser") {
          window.open("manager.html", "_self");
        }

      } else {
        // Not logged in (guest)
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        localStorage.setItem("uid", "901");
        localStorage.setItem("fullname", "Park Guest");
        localStorage.setItem("activepictureurl", "./images/bluecircle.png");
        document.getElementById("userGreeting").innerHTML = "Welcome, Guest"; // Display "Guest"
      }
    }

    function logoutUser(event) {
      event.preventDefault();
      console.log("Logging out user...");

      localStorage.clear();
      localStorage.setItem("uid", "901");
      localStorage.setItem("fullname", "ParkGuest");
      localStorage.setItem("role", "guest");

      console.log("Local storage after logout:", localStorage);
      clearUserSession();
      window.location.replace("login.html");
    }

    function clearUserSession() {
  const sometoken = localStorage.getItem('token');
  if (!sometoken) {
    console.warn("No token found in localStorage.");
    return;
  }

  const logoutApiUrl = `https://cockyapiv3-bugudue8akcsbacz.westus3-01.azurewebsites.net/api/Users/logout/${sometoken}`;

  $.post(logoutApiUrl)
    .done(function () {
      alert("Session closed.");
    })
    .fail(function (xhr, status, error) {
      console.error("Error closing session:", xhr.responseText);
    });
}

    
    function loginUser(event) {
      event.preventDefault();
      console.log("Logging in user...");

      localStorage.clear();
      localStorage.setItem("uid", "901");
      localStorage.setItem("fullname", "ParkUser");
      localStorage.setItem("role", "guest");
      localStorage.setItem("isemployee", "0");
      window.open("login.html", "_self");
    }

    
    // On page load, check uid, fetch user info
    $(document).ready(function () {
      var someuid = localStorage.getItem('uid');
      var somerole = localStorage.getItem('role');
      console.log('UID:', someuid);
      if(someuid === '901')
      {
      //donothing stay on home page.
      }
      else if (somerole === 'superuser') {
        window.open("manager.html", "_self");
      }
       else if (someuid && someuid !== '901') {
		// donothing - already handled.
      }
    });
      function openModal() {
      document.getElementById('travelModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('travelModal').style.display = 'none';
    }
	  
   	function closeBox() {
      document.getElementById('travelModal').style.display = 'none';
    }

  </script>
</body>
    <!-- Footer -->
  <footer class="footer"> &copy; Cocky Consulting 2025. <br> All rights reserved.<br>  <span align="center"><a href="sitemap.html" class="sitelink">SiteMap</a></span></footer>

</html>
