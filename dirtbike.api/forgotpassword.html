<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="forgotpassword.css" rel="stylesheet">
    <script src="./js/bikes.js"></script>
    <link href="login.css" rel="stylesheet">
</head>
<body onload="checkUserStatus(); displayProfilePicture();">
    <!-- Navigation Bar -->
    <div class="navbar">
      <div class="nav-left">
            <div class="dropdown">
                  <button class="jsmenu"><img src="./images/jsmenu4.png"></button> 
                  <div class="dropdown-content">
                  <a href="index.html">Site Home</a>
                  <a href="cartreview.html">MyCart</a>
                  <a href="parks5.html">Review Park Options</a>
                  <a href="parksreview5.html">Park Reviews</a>
                  <a href="mybookings5.html">MyReservations</a>
                  <a href="manager.html">Manager Utilities</a>
             </div>
    </div> 
              <div class="logo">&nbsp&nbsp<H5>MyLinkv25 - Review Parks<H5></div>

<div class="forgot-password-page">
    <div class="forgot-password-container">
        <h2>Reset Your Password</h2>
        <p>Enter your email address below, and we'll send you a link to reset your password.</p>
        <form id="forgotPasswordForm">
            <input type="email" id="email" placeholder="Email Address" required>
            <button type="submit">Send Reset Link</button>
        </form>
        <a href="login.html">Back to Login</a>
    </div>
</div>

<script>
    // Handle forgot password form submission
    document.getElementById('forgotPasswordForm').addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent form from submitting the traditional way

        const email = document.getElementById('email').value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Regex for validating email format

        if (!email) {
            alert('Please enter your email address');
            return;
        }

        if (!emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
        }
    try {
            // Step 1: Check if the email exists for any User
            const userCheckResponse = await fetch('https://cockyapiv3-bugudue8akcsbacz.westus3-01.azurewebsites.net/api/Users', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
    
            if (!userCheckResponse.ok) throw new Error('Failed to fetch users');
    
            const users = await userCheckResponse.json();
            const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
    
            if (!user) {
                alert('No account found with that email address.');
                return;
            }
    
            // Step 2: If user exists, send the reset password request
            const forgotPasswordResponse = await fetch('https://cockyapiv3-bugudue8akcsbacz.westus3-01.azurewebsites.net/api/Auth/forgotPassword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ Email: email })
            });
    
            const data = await forgotPasswordResponse.json();
    
            if (forgotPasswordResponse.ok) {
                alert('A password reset link has been sent to your email!');
            } else {
                alert(data.message || 'Failed to send reset link');
            }
        } catch (error) {
            alert('Error: ' + error.message);
         });
    });
</script>

</body>
</html>
